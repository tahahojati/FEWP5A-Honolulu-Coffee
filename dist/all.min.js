function mapsError(){window.alert("Sorry! request to google maps failed :("),googleError=!0}function MarkerAndInfo(e,o,i,n){googleError||(null===infoWindow&&(infoWindow=new google.maps.InfoWindow),this.googleMarker=new google.maps.Marker({position:new google.maps.LatLng(e),map:o,animation:google.maps.Animation.DROP,title:i}),this.infoContent=n,this.clicked=$.proxy(function(){infoWindow.setContent(this.infoContent),this.googleMarker.setAnimation(google.maps.Animation.BOUNCE),window.setTimeout(function(e){e.googleMarker.setAnimation(null)},1500,this),infoWindow.open(map,this.googleMarker)},this),this.googleMarker.addListener("click",this.clicked))}function initMap(){map=new google.maps.Map(document.getElementById("map"),{center:{lat:21.278518,lng:-157.828231},zoom:12}),markers=[]}function CoffeePlace(e){this.fourSquareID=e,this.completedAJAX=!1,this.marker=null,this.fourSquareSuccess=function(){var e=this;return function(o){e.name=o.response.venue.name,e.latlng={lat:o.response.venue.location.lat,lng:o.response.venue.location.lng},e.img=o.response.venue.bestPhoto.prefix+"width200"+o.response.venue.bestPhoto.suffix,e.rating=o.response.venue.rating,e.completedAJAX=!0,e.marker=new MarkerAndInfo(e.latlng,map,e.name,infoFormat.replace("%name%",e.name).replace("%img%",e.img).replace("%rating%",e.rating))}},$.getJSON(FOURSQUAREVENUEENDPOINT+this.fourSquareID,{client_id:FOURSQUAREID,client_secret:FOURSQUARESECRET,v:"20160101",m:"swarm"},this.fourSquareSuccess()).fail($.proxy(function(){this.completedAJAX="error"},this))}function Model(){this.places=[new CoffeePlace("539b9c22498e606f9b3b1f7a"),new CoffeePlace("4b60e1ecf964a52095ff29e3"),new CoffeePlace("4b7b7a54f964a520f9642fe3"),new CoffeePlace("53758c1b11d20b26da933dac"),new CoffeePlace("51bbbbb12fc61cb0b5bf190a"),new CoffeePlace("4d13dff1816af04de34237c2")],this.size=function(){return this.places.length},this.populate=function(e,o){e.removeAll();for(var i=0;i<this.places.length;++i)this.pushElement(this,e,i,0,o)},this.pushElement=function(e,o,i,n,s){"error"===e.places[i].completedAJAX?s(!0):e.places[i].completedAJAX?o.push(e.places[i]):30>n?(++n,setTimeout(e.pushElement,200,e,o,i,n,s)):s(!0)}}function AppViewModel(){this.ajaxErrors=ko.observable(!1),this.searchTerm=ko.observable(""),this.shops=ko.observableArray(),this.visible=[],CoffeePlacesModel.populate(this.shops,this.ajaxErrors);for(var e=0;e<CoffeePlacesModel.size();++e)this.visible.push(ko.observable(!0));this.doSearch=function(){var e=this;return function(){var o=0,i=e.shops().length;for(o=0;i>o;++o)-1==e.shops()[o].name.search(new RegExp(e.searchTerm(),"i"))?(e.visible[o](!1),e.shops()[o].markvisible(!1)):(e.visible[o](!0),e.shops()[o].markvisible(!0))}},this.searchTerm.subscribe(this.doSearch())}var map,googleError,infoWindow=null,FOURSQUAREID="PEVDLWKZEUCSU1ULZMCKDV4SMRWDIBTJ0O0SA5PEDSEFHQA5",FOURSQUARESECRET="QZ3SKHECKEKEDL3I1RHYD2F00ZRDJKZ0Z4Z3BHAY45PMP55U",FOURSQUAREVENUEENDPOINT="https://api.foursquare.com/v2/venues/",infoFormat='<div class="maps-note"><h4>%name%</h4><img class="img-responsive" src="%img%" alt="Best img from foursquare"><p>foursquare rating: %rating%</p> </div>';CoffeePlace.prototype.markvisible=function(e){this.marker.googleMarker.setVisible(e),e&&!this.marker.markerVisible&&this.marker.googleMarker.setAnimation(google.maps.Animation.DROP),this.marker.markerVisible=e};var CoffeePlacesModel=new Model,main=new AppViewModel;ko.applyBindings(main);