function MarkerAndInfo(e,o,s,i){this.googleMarker=new google.maps.Marker({position:new google.maps.LatLng(e),map:o,animation:google.maps.Animation.DROP,title:s}),this.infoWindow=new google.maps.InfoWindow({content:i}),this.markerVisible=!0,this.showNote=$.proxy(function(){console.log(this.infoWindow),this.infoWindow.open(map,this.googleMarker)},this),this.googleMarker.addListener("click",this.showNote)}function initMap(){map=new google.maps.Map(document.getElementById("map"),{center:{lat:21.278518,lng:-157.828231},zoom:12}),markers=[]}function CoffeePlace(e){this.fourSquareID=e,this.completedAJAX=!1,this.marker=null,this.noteIndex=0,this.clousure=function(){var e=this;return function(o){e.name=o.response.venue.name,e.latlng={lat:o.response.venue.location.lat,lng:o.response.venue.location.lng},e.img=o.response.venue.bestPhoto.prefix+"width200"+o.response.venue.bestPhoto.suffix,e.rating=o.response.venue.rating,e.completedAJAX=!0,e.noteIndex=markers.length,e.marker=new MarkerAndInfo(e.latlng,map,e.name,infoFormat.replace("%name%",e.name).replace("%img%",e.img).replace("%rating%",e.rating))}},$.getJSON(FOURSQUAREVENUEENDPOINT+this.fourSquareID,{client_id:FOURSQUAREID,client_secret:FOURSQUARESECRET,v:"20160101",m:"swarm"},this.clousure())}function Model(){this.places=[new CoffeePlace("539b9c22498e606f9b3b1f7a"),new CoffeePlace("4b60e1ecf964a52095ff29e3"),new CoffeePlace("4b7b7a54f964a520f9642fe3"),new CoffeePlace("53758c1b11d20b26da933dac"),new CoffeePlace("51bbbbb12fc61cb0b5bf190a"),new CoffeePlace("4d13dff1816af04de34237c2")],this.size=function(){return this.places.length},this.populate=function(e){e.removeAll();for(var o=0;o<this.places.length;++o)this.pushElement(this,e,o)},this.pushElement=function(e,o,s){e.places[s].completedAJAX?o.push(e.places[s]):setTimeout(e.pushElement,200,e,o,s)}}function AppViewModel(){this.searchTerm=ko.observable(""),this.shops=ko.observableArray(),this.visible=[],CoffeePlacesModel.populate(this.shops);for(var e=0;e<CoffeePlacesModel.size();++e)this.visible.push(ko.observable(!0));this.dosearch=function(){var e=this;return function(){var o=0,s=e.shops().length;for(o=0;s>o;++o)-1==e.shops()[o].name.search(new RegExp(e.searchTerm(),"i"))?(e.visible[o](!1),e.shops()[o].markvisible(!1)):(e.visible[o](!0),e.shops()[o].markvisible(!0))}},this.searchTerm.subscribe(this.dosearch())}var map,FOURSQUAREID="PEVDLWKZEUCSU1ULZMCKDV4SMRWDIBTJ0O0SA5PEDSEFHQA5",FOURSQUARESECRET="QZ3SKHECKEKEDL3I1RHYD2F00ZRDJKZ0Z4Z3BHAY45PMP55U",FOURSQUAREVENUEENDPOINT="https://api.foursquare.com/v2/venues/",infoFormat='<div class="maps-note"><h4>%name%</h4><img class="img-responsive" src="%img%" alt="Best img from foursquare"><p>foursquare rating: %rating%</p> </div>';CoffeePlace.prototype.markvisible=function(e){this.marker.googleMarker.setVisible(e),e&&!this.marker.markerVisible&&this.marker.googleMarker.setAnimation(google.maps.Animation.DROP),this.marker.markerVisible=e};var CoffeePlacesModel=new Model,main=new AppViewModel;ko.applyBindings(main);